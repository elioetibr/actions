{"version":3,"file":"lib.mjs","sources":["../../src/tools/lib.ts"],"sourcesContent":["import type { IAgent, IRunner, IRunnerResult, AgentFactory, RunnerFactory } from '../agents/interfaces';\nimport { createGitHubActionsAgent } from '../agents/github/agent';\nimport { createDockerImageToolsRunner } from './docker/imagetools/runner';\nimport { createTerraformRunner } from './terraform/runner';\nimport { createTerragruntRunner } from './terragrunt/runner';\n\n/**\n * Registry of available agents\n */\nconst agents: Map<string, AgentFactory> = new Map([\n  ['github', createGitHubActionsAgent],\n]);\n\n/**\n * Registry of available runners\n */\nconst runners: Map<string, RunnerFactory> = new Map([\n  ['docker/imagetools', createDockerImageToolsRunner],\n  ['terraform', createTerraformRunner],\n  ['terragrunt', createTerragruntRunner],\n]);\n\n/**\n * Get an agent by name\n * @param name - The agent name (e.g., 'github')\n */\nexport function getAgent(name: string): IAgent {\n  const factory = agents.get(name);\n  if (!factory) {\n    const available = Array.from(agents.keys()).join(', ');\n    throw new Error(`Unknown agent '${name}'. Available agents: ${available}`);\n  }\n  return factory();\n}\n\n/**\n * Get a runner by name\n * @param name - The runner name (e.g., 'docker/imagetools')\n */\nexport function getRunner(name: string): IRunner {\n  const factory = runners.get(name);\n  if (!factory) {\n    const available = Array.from(runners.keys()).join(', ');\n    throw new Error(`Unknown runner '${name}'. Available runners: ${available}`);\n  }\n  return factory();\n}\n\n/**\n * Main entry point for running a tool step\n * @param agentName - The agent to use (e.g., 'github')\n * @param runnerName - The runner to use (e.g., 'docker/imagetools')\n * @param step - The step to run (e.g., 'setup', 'command', 'execute')\n * @returns Promise with the runner result\n *\n * @example\n * // In a sub-action's main.mjs:\n * import { run } from '../../../dist/tools/lib.mjs';\n * await run('github', 'docker/imagetools', 'setup');\n */\nexport async function run(\n  agentName: string,\n  runnerName: string,\n  step: string,\n): Promise<IRunnerResult> {\n  const agent = getAgent(agentName);\n  const runner = getRunner(runnerName);\n\n  agent.debug(`Running ${runnerName}:${step}`);\n\n  const result = await runner.run(agent, step);\n\n  // Set outputs on the agent\n  for (const [key, value] of Object.entries(result.outputs)) {\n    agent.setOutput(key, value);\n  }\n\n  // Handle errors\n  if (!result.success && result.error) {\n    agent.setFailed(result.error);\n  }\n\n  return result;\n}\n\n// Export types and utilities\nexport type { IAgent, IRunner, IRunnerResult, AgentFactory, RunnerFactory } from '../agents/interfaces';\nexport { RunnerBase } from './common/runner-base';\n"],"names":[],"mappings":";;;;;;AASA,MAAM,MAAA,uBAAwC,GAAA,CAAI;AAAA,EAChD,CAAC,UAAU,wBAAwB;AACrC,CAAC,CAAA;AAKD,MAAM,OAAA,uBAA0C,GAAA,CAAI;AAAA,EAClD,CAAC,qBAAqB,4BAA4B,CAAA;AAAA,EAClD,CAAC,aAAa,qBAAqB,CAAA;AAAA,EACnC,CAAC,cAAc,sBAAsB;AACvC,CAAC,CAAA;AAMM,SAAS,SAAS,IAAA,EAAsB;AAC7C,EAAA,MAAM,OAAA,GAAU,MAAA,CAAO,GAAA,CAAI,IAAI,CAAA;AAC/B,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,MAAA,CAAO,MAAM,CAAA,CAAE,KAAK,IAAI,CAAA;AACrD,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,eAAA,EAAkB,IAAI,CAAA,qBAAA,EAAwB,SAAS,CAAA,CAAE,CAAA;AAAA,EAC3E;AACA,EAAA,OAAO,OAAA,EAAQ;AACjB;AAMO,SAAS,UAAU,IAAA,EAAuB;AAC/C,EAAA,MAAM,OAAA,GAAU,OAAA,CAAQ,GAAA,CAAI,IAAI,CAAA;AAChC,EAAA,IAAI,CAAC,OAAA,EAAS;AACZ,IAAA,MAAM,SAAA,GAAY,MAAM,IAAA,CAAK,OAAA,CAAQ,MAAM,CAAA,CAAE,KAAK,IAAI,CAAA;AACtD,IAAA,MAAM,IAAI,KAAA,CAAM,CAAA,gBAAA,EAAmB,IAAI,CAAA,sBAAA,EAAyB,SAAS,CAAA,CAAE,CAAA;AAAA,EAC7E;AACA,EAAA,OAAO,OAAA,EAAQ;AACjB;AAcA,eAAsB,GAAA,CACpB,SAAA,EACA,UAAA,EACA,IAAA,EACwB;AACxB,EAAA,MAAM,KAAA,GAAQ,SAAS,SAAS,CAAA;AAChC,EAAA,MAAM,MAAA,GAAS,UAAU,UAAU,CAAA;AAEnC,EAAA,KAAA,CAAM,KAAA,CAAM,CAAA,QAAA,EAAW,UAAU,CAAA,CAAA,EAAI,IAAI,CAAA,CAAE,CAAA;AAE3C,EAAA,MAAM,MAAA,GAAS,MAAM,MAAA,CAAO,GAAA,CAAI,OAAO,IAAI,CAAA;AAG3C,EAAA,KAAA,MAAW,CAAC,KAAK,KAAK,CAAA,IAAK,OAAO,OAAA,CAAQ,MAAA,CAAO,OAAO,CAAA,EAAG;AACzD,IAAA,KAAA,CAAM,SAAA,CAAU,KAAK,KAAK,CAAA;AAAA,EAC5B;AAGA,EAAA,IAAI,CAAC,MAAA,CAAO,OAAA,IAAW,MAAA,CAAO,KAAA,EAAO;AACnC,IAAA,KAAA,CAAM,SAAA,CAAU,OAAO,KAAK,CAAA;AAAA,EAC9B;AAEA,EAAA,OAAO,MAAA;AACT;;;;"}